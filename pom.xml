<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">

	<modelVersion>4.0.0</modelVersion>
	<groupId>uk.co.bithatch</groupId>
	<artifactId>bithatch-maven-p2</artifactId>
	<version>1.0.0</version>
	<packaging>pom</packaging>
	<name>Generate p2 repository from Maven Central</name>
	
    <distributionManagement>
        <repository>
            <id>bithatch-website</id>
            <url>ftp://bithatch.co.uk/httpdocs/repositories/p2_new</url>
            <layout>p2</layout>
        </repository>
  </distributionManagement>
  
  <properties>
  
    <zyxy.version>0.0.4-SNAPSHOT</zyxy.version>
    <zyxy.bundle.version>0.0.4</zyxy.bundle.version>
    <build.upload.hostname>bithatch.co.uk</build.upload.hostname>
    <build.upload.path>/httpdocs/repositories/p2_new</build.upload.path>
    <build.upload.username>bithatch</build.upload.username>
    <build.upload.password>__YOUR_PASSWORD__</build.upload.password>
                                     
  </properties>

	<repositories>
		
		<repository>
            <id>central-snapshots</id>
            <url>https://central.sonatype.com/repository/maven-snapshots</url>
            <snapshots/>
            <releases>
                <enabled>false</enabled>
            </releases>
        </repository>
    
	</repositories>

	<build>    
    	<extensions>
          <!-- Enabling the use of FTP -->
          <extension>
            <groupId>org.apache.maven.wagon</groupId>
             <artifactId>wagon-ftp</artifactId>
             <version>2.8</version>
          </extension>
        </extensions>
		<plugins>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-deploy-plugin</artifactId>
                <version>3.1.4</version>
                <configuration>
                    <skip>true</skip>
                </configuration>
            </plugin>
			<plugin>
				<groupId>org.reficio</groupId>
				<artifactId>p2-maven-plugin</artifactId>
				<version>2.1.0</version>
				<executions>
					<execution>
						<id>generate-p2-site</id>
						<phase>package</phase>
						<goals>
							<goal>site</goal>
						</goals>
						<configuration>

							<artifacts>

								<artifact>
									<id>uk.co.bithatch:zyxy-lib:${zyxy.version}</id>
									<override>true</override>
									<instructions>
										<Import-Package>*;resolution:=optional</Import-Package>
										<Require-Capability>osgi.ee;filter:="(&amp;(osgi.ee=JavaSE)(version=21))"</Require-Capability>
										<Bundle-Vendor>Bithatch</Bundle-Vendor>
										<Bundle-Name>ZYXY Library</Bundle-Name>
										<Bundle-Version>${zyxy.bundle.version}</Bundle-Version>
									</instructions>
								</artifact>
								<artifact>
									<id>uk.co.bithatch:zyxy-graphics:${zyxy.version}</id>
									<override>true</override>
									<instructions>
										<Import-Package>*;resolution:=optional</Import-Package>
										<Require-Capability>osgi.ee;filter:="(&amp;(osgi.ee=JavaSE)(version=21))"</Require-Capability>
										<Bundle-Vendor>Bithatch</Bundle-Vendor>
										<Bundle-Name>ZYXY Graphics</Bundle-Name>
                                        <Bundle-Version>${zyxy.bundle.version}</Bundle-Version>
									</instructions>
								</artifact>
								<artifact>
									<id>uk.co.bithatch:zyxy-compress:${zyxy.version}</id>
									<override>true</override>
									<instructions>
										<Import-Package>*;resolution:=optional</Import-Package>
										<Require-Capability>osgi.ee;filter:="(&amp;(osgi.ee=JavaSE)(version=21))"</Require-Capability>
										<Bundle-Vendor>Bithatch</Bundle-Vendor>
										<Bundle-Name>ZYXY Compress</Bundle-Name>
                                        <Bundle-Version>${zyxy.bundle.version}</Bundle-Version>
									</instructions>
								</artifact>
								<artifact>
									<id>uk.co.bithatch:zyxy-mmc:${zyxy.version}</id>
									<override>true</override>
									<instructions>
										<Import-Package>*;resolution:=optional</Import-Package>
										<Require-Capability>osgi.ee;filter:="(&amp;(osgi.ee=JavaSE)(version=21))"</Require-Capability>
										<Bundle-Vendor>Bithatch</Bundle-Vendor>
										<Bundle-Name>ZYXY MMC</Bundle-Name>
                                        <Bundle-Version>${zyxy.bundle.version}</Bundle-Version>
									</instructions>
								</artifact>
								<artifact>
									<id>uk.co.bithatch:zyxy-dezog:${zyxy.version}</id>
									<override>true</override>
									<instructions>
										<Import-Package>*;resolution:=optional</Import-Package>
										<Require-Capability>osgi.ee;filter:="(&amp;(osgi.ee=JavaSE)(version=21))"</Require-Capability>
										<Bundle-Vendor>Bithatch</Bundle-Vendor>
										<Bundle-Name>ZYXY Dezog</Bundle-Name>
                                        <Bundle-Version>${zyxy.bundle.version}</Bundle-Version>
									</instructions>
								</artifact>

								<artifact>
									<id>org.slf4j:slf4j-api:2.0.17</id>
								</artifact>

								<artifact>
									<id>org.slf4j:slf4j-simple:2.0.17</id>
								</artifact>

								<artifact>
									<id>uk.co.bithatch:fat32-lib:0.6.6-bithatch</id>
                                    <override>true</override>
									<instructions>
                                        <Bundle-Version>0.6.6</Bundle-Version>
										<Bundle-Vendor>Bithatch</Bundle-Vendor>
										<Bundle-Name>FAT32 Support</Bundle-Name>
										<Bundle-Symbolic-Name>uk.co.bithatch.fat32</Bundle-Symbolic-Name>
										<Export-Package>*;resolution:=optional</Export-Package>
										<Import-Package>*;resolution:=optional</Import-Package>
										<Require-Capability>osgi.ee;filter:="(&amp;(osgi.ee=JavaSE)(version=17))"</Require-Capability>
									</instructions>
								</artifact>

								<artifact>
									<id>uk.co.bithatch:jspeccy:1.0.2-bithatch</id>
									<instructions>
										<Export-Package>
											gui;version="1.0.2",
											joystickinput;version="1.0.2",
											jspeccy;version="1.0.2",
											machine;version="1.0.2",
											snapshots;version="1.0.2",
											tv.porst.jhexview;version="1.0.2",
											tv.porst.splib.*;version="1.0.2",
											utilities;version="1.0.2",
											z80core;version="1.0.2"
										</Export-Package>
										<Import-Package>org.slf4j, *;resolution:=optional</Import-Package>
										<Require-Capability>osgi.ee;filter:="(&amp;(osgi.ee=JavaSE)(version=17))"</Require-Capability>
									</instructions>
								</artifact>

							</artifacts>
						</configuration>
					</execution>
				</executions>
			</plugin>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-antrun-plugin</artifactId>
                <version>3.1.0</version>
                <dependencies>
                    <dependency>
                        <groupId>org.apache.ant</groupId>
                        <artifactId>ant-commons-net</artifactId>
                        <version>1.10.15</version>
                    </dependency>
                </dependencies>
                <executions>
                    <execution>
                        <id>copy-p2-repo</id>
                        <phase>deploy</phase>
                        <configuration>
                            <target>
                                <ftp action="del"
                                     server="${build.upload.hostname}"
                                     remotedir="${build.upload.path}"
                                     userid="${build.upload.username}"
                                     password="${build.upload.password}">
                                    <fileset>
                                        <include name="**/"/>
                                    </fileset>
                                </ftp>
                                <ftp action="mkdir"
                                     server="${build.upload.hostname}"
                                     remotedir="${build.upload.path}"
                                     userid="${build.upload.username}"
                                     password="${build.upload.password}">
                                </ftp>
                                <ftp server="${build.upload.hostname}"
                                     remotedir="${build.upload.path}"
                                     userid="${build.upload.username}"
                                     password="${build.upload.password}"
                                     depends="yes">
                                    <fileset dir="target/repository"/>
                                </ftp>
                            </target>
                        </configuration>
                        <goals>
                            <goal>run</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>

		</plugins>
		
	</build>
	
</project>
